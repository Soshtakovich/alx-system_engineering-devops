#!/usr/bin/env bash
# Configures a new ubuntu machine by installing
# Nginx where it should be listening on port 80
# Serve a page that would return a Hello World string

# Update package index
apt-get update

# Install Nginx
apt-get install -y nginx

# Set Nginx to listen on port 80
sed -i 's/^listen\s*80\s*;$/listen 80;/g' /etc/nginx/sites-available/default

# Restart Nginx using its init script
/etc/init.d/nginx restart

# Check if Nginx is running
if pgrep nginx >/dev/null; then
    echo "Nginx installed and running."
else
    echo "Error: Nginx is not running."
fi

# Create a temporary HTML file containing "Hello World!"
echo "<!DOCTYPE html>
<html>
<head>
<title>Hello World!</title>
</head>
<body>
<h1>Hello World!</h1>
</body>
</html>" > /var/www/html/index.html

# Check if Nginx returns "Hello World!" when queried
response=$(curl -s http://localhost)
if [[ $response == *"Hello World!"* ]]; then
    echo "Nginx is serving 'Hello World!' correctly."
else
    echo "Error: Nginx is not serving 'Hello World!' correctly."
fi
